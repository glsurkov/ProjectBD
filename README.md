 # Описание
  Букинг сервис, позволяющий пользователям бронировать билеты на авиаперелеты и номера в отелях. 
  В начале пользователь должен пройти регистрацию в системе, а затем войти в нее. После входа пользователь может просматривать предложенные авиаперелеты и всю информацию о них (авиакомпания, осуществляющая перелет, аэропорт, страна, город, время, дата). Конечно, пользователь сможет фильтровать предлагаемые ему перелеты по всем параметрам, чтобы максимально быстро найти интересующее его предложение. После того как пользователь нашел то, что ему нужно, он может забронировать перелет, если билеты на перелет еще в наличии, и у клиента на балансе имеется необходимая сумма денег, соответствующая стоимости билета. После приобретения билета пользователю с соответствие ставится данный перелет, и он может видеть его в своем профиле. Аналогичная ситуация будет возникать с отелями. 
  Пользователь имеет возможность посетить свой собственный профиль, где указана информация о его балансе (его можно пополнить), активных и прошлых бронированиях. Если пользователь уже отдыхал в отеле, то он может прикрепить фотографии соответствующего отеля.
  У администратора будут дополнительные возможности по сравнению с обычными пользователями:  добавление, изменение, удаление авиакомпаний, перелетов конкретных авиакомпаний, отелей, аэропортов, стран и фотографий.


## Наименование
AirBook
## Предметная область
Путешествия
# Данные

### users
Информация о зарегистрированных пользователях.
|NAME|TYPE|CONSTRAINT|
|---|---|---|
|user_id| SERIAL |NOT NULL PRIMARY KEY|
|username| VARCHAR(256)| NOT NULL UNIQUE|
|password| VARCHAR(256)| NOT NULL
|role| VARCHAR(256)| NOT NULL|
|balance| VARCHAR(256)| NOT NULL CHECK(balance>=0)|

### countries
Информация о странах в системе.
|NAME|TYPE|CONSTRAINT|
|---|---|---|
|country_name| VARCHAR(256)| PRIMARY KEY|
|population| INTEGER| NOT NULL |
|capital_city| VARCHAR(256)| NOT NULL|

### airports
Информация о аэропортах в системе.
|NAME|TYPE|CONSTRAINT|
|---|---|---|
|airport_id| SERIAL| PRIMARY KEY|
|airport_name| VARCHAR(256) | NOT NULL|
|airport_country |VARCHAR(256)| FOREIGN KEY(countries) NOT NULL ON DELETE CASCADE|

### aviacompanies
Информация о авиакомпаниях в системе.
|NAME|TYPE|CONSTRAINT|
|---|---|---|
|company_id| SERIAL | PRIMARY KEY|
|company_name |VARCHAR(256)| NOT NULL, UNIQUE|
|company_phone|VARCHAR(256)| NOT NULL|


### hotels
Информация о отелях в системе.
|NAME|TYPE|CONSTRAINT|
|---|---|---|
|hotel_id| SERIAL |PRIMARY KEY|
|hotel_country |VARCHAR(256)| FOREIGN KEY(countries) NOT NULL ON DELETE CASCADE|
|room_price|INTEGER| NOT NULL CHECK(room_price>0)|
|rooms_in_stock|INTEGER|NOT NULL CHECK(room_price>0)|
|hotel_name|VARCHAR(256)|NOT NULL UNIQUE|
|hotel_city|VARCHAR(256)|NOT NULL|
|available|INTEGER|NOT NULL DEFAULT 1 CHECK(available>=0) CHECK(available<=1)|

UNIQUE(book_id, user_id)

### flights
Информация о перелетах в системе.
|NAME|TYPE|CONSTRAINT|
|---|---|---|
|flight_id| SERIAL |PRIMARY KEY|
|company_id| INTEGER |NOT NULL FOREIGN KEY(aviacompanies) ON DELETE CASCADE|
|departure_date| DATE |NOT NULL|
|departure_time| TIME WITHOUT TIMEZONE |NOT NULL|
|departure_airport_id|INTEGER| NOT NULL FOREIGN KEY(airports) ON DELETE CASCADE|
|arrival_date|DATE|NOT NULL|
|arrival_time|TIME WITHOUT TIMEZONE|NOT NULL|
|arrival_airport_id|INTEGER|NOT NULL FOREIGN KEY(airports) ON DELETE CASCADE|
|tickets_in_stock|INTEGER|NOT NULL CHECK(tickets_in_stock=>0)|
|ticket_price|INETGER|NOT NULL CHECK(ticket_price=>0)|
|active|INTEGER|NOT NULL DEFAULT 1 CHECK(active>0) CHECK(active<=1)|

### users_flights
Бронирования перелетов, совершенные пользователями.
|NAME|TYPE|CONSTRAINT|
|---|---|---|
|flight_order| SERIAL |PRIMARY KEY|
|user_id| INTEGER |NOT NULL FOREIGN KEY(users) ON DELETE CASCADE|
|flight_id| INTEGER |NOT NULL FOREIGN KEY(flights) ON DELETE CASCADE|

### users_hotels
Бронирования отелей, совершенные пользователями.
|NAME|TYPE|CONSTRAINT|
|---|---|---|
|hotel_order| SERIAL |PRIMARY KEY|
|user_id| INTEGER |NOT NULL FOREIGN KEY(users) ON DELETE CASCADE|
|hotel_id| INTEGER |NOT NULL FOREIGN KEY(hotels) ON DELETE CASCADE|
|arrival_date|DATE|NOT NULL|
|departure_date|DATE|NOT NULL|
|active|INTEGER|NOT NULL DEFAULT 1 CHECK(active=>0) CHECK(active<=1)|

### images
Информация о фотографиях, загружаемых пользователями после отдыха в отеле.
|NAME|TYPE|CONSTRAINT|
|---|---|---|
|image_id| SERIAL |PRIMARY KEY|
|hotel_id| INTEGER |NOT NULL FOREIGN KEY(hotels) ON DELETE CASCADE|
|image| VARCHAR(256) |NOT NULL|

![ER-diagram (4)](https://user-images.githubusercontent.com/61556904/146264663-56ba1aec-e181-4802-8d08-a28f626e8810.png)

## Общие ограничения целостности
- Связь *один-ко-многим* между `countries` и `airports`
- Связь *один-ко-многим* между `countries` и `hotels`
- Связь *один-ко-многим* между `aviacompanies` и `flights`
- Связь *один-ко-многим* между `hotels` и `images`
- Связь *один-ко-многим* между `airports` и `flights`
- Связь *многие-ко-многим* между `users` и `flights` (`users_flights`)
- Связь *многие-ко-многим* между `users` и `hotels` (`users_hotels`)

## Transactions

`bookFlight`:

Транзакция, осуществляющая бронирование перелета пользователем.

 - В таблице `flights` уменьшаем значение `tickets_in_stock` на 1 у соответсвующего перелета. Если `tickets_in_stock` достигло своего минимального значения равного нулю,
то при попытке уменьшения на 1 изменения не применяются, выполняем ROLLBACK.
 - В таблице `users` уменьшаем значение `balance` на величину равную цене билета у соответствующего пользователя. Если значение `balance` меньше значения цены билета, то изменения не применяются, выполняем ROLLBACK.
 - В таблице `users_flights` создаем запись, которая включает `user_id`, `hotel_id` и характеризует успешное бронирование. Если запись не создалась, 
то изменения не применяются, выполняем ROLLBACK.

Изменения применяются в случае удачного выполнения всех вышеописанных запросов, выполняем COMMIT.


`bookHotel`:

Транзакция, осуществляющая бронирование отеля пользователем.


 - В таблице `hotels` уменьшаем значение `rooms_in_stock` на 1 у соответствующего отеля. Если `rooms_in_stock` достигло своего минимального значения равного нулю,
то при попытке уменьшения на 1 изменения не применяются, выполняем ROLLBACK.
 - В таблице `users` уменьшаем значение `balance` на величину равную цене номера за все забронированные дни. Если значение balance меньше значения суммы оплаты, то 
изменения не применяются, выполняем ROLLBACK.
 - В таблице `users_hotels` создаем запись, которая включает `user_id`, `hotel_id` и характеризует успешное бронирование. Если запись не создалась, 
то изменения не применяются, выполянем ROLLBACK.

Изменения применяются в случае удачного выполнения всех вышеописанных запросов, выполняем COMMIT.


`updateFlight`:

Транзакция, осуществляющая изменение полетов.

 - В таблице `aviacompanies` находим строку с соответствующим значением в company_name. Если строка не была найдена, то изменения не применяются, выполняем ROLLBACK.
 - В таблице `airports` находим строку с соответствующим значением в `airport_name` (departure_airport). Если строка не была найдена, то изменения не применяются, выполняем ROLLBACK.
 - В таблице `airports` находим строку с соотвутствующим значением в `airport_name` (arrival_name). Если строка не была найдена, то изменения не применяются, выполняем ROLLBACK.
 - В таблице `flights` изменяем значения атрибутов в соответствии с полученными от пользователя значениями. Если изменение атрибутов оказалось неудачным, то изменения не применяются, выполняем ROLLBACK.

Изменения применяются в случае удачного выполнения всех вышеописанных запросов, выполняем COMMIT.


`activeHotelOrder`:

Транзакция, осуществляющая отслеживание актуальности бронирования номерой отелей.

 - В таблице `users_hotels` устанавливаем значение 0 у атрибута `active`, у тех строк где дата конца бронирования не ялвяется актуальной и значение поля active равно 1. В случае неудачного изменения аттрибутов изменения не применяются, выполняем ROLLBACK.
 - В таблице `hotels` увелеичиваем значение `rooms_in_stock` на 1 у тех отелей, для которых было произведено обновление акутальности бронирований на предыдущем шаге. В случае неудачного изменения
аттрибутов изменения не применяются, выполняем ROLLBACK.

Изменения применяются в случае удачного выполнения всех вышеописанных запросов, выполняем COMMIT.

# Пользовательские роли
`admin`(кол-во: 1)
- может cоздавать, изменять и удалять страны, аэропорты, авиакомпании, перелеты, отели в системе
- может удалять фотографии, которые были добавлены, другими пользователями
- в остальном доступен тот же функционал, что и у user
- чтобы пользователь получил роль admin ему необходимо зарегистрироваться в системе используя следующий логин:admin и пароль:admin

`user`(кол-во: не ограничено)
- просмотр доступных перелетов и отелей
- бронирование перелетов и номеров в отелях
- просмотр своего профиля, пополнение баланса
- просмотр активных бронирований
- просмотр прошлых бронирований

# UI/API
- **UI:** React
- Общие сведения:

Все всплывающие модальные окна приложения закрываются при помощи нажатия на любую область за пределами окна.

Страница регистрации:

 - Кнопка Sign Up - позовляет пользователю зарегистрироваться в системе, придумав имя пользователя и пароль, если имя пользователя уже занято, то пользователь не будет зарегистрирован.
 - После завершения регистрации пользователю необходимо войти в систему, нажав кнопку Sign In и внеся данные, используемые при регистрации.


Главная страница:

Переход на главную страницу происходит после входа пользователя в систему.

 - Кнопка HOTELS при нажатии позволяет получить список отелей, доступных для бронирования, также присутсвтует возможность фильтрации отелей при помощи окна, расположенного в правой части экрана.
 - Кнопка FLGHTS при нажатии позволяет получить список полетов, если билеты на перелет закончились, то у перелета будет соответствующая надпись "Билетов нет". Также присутсвтует
возможность фильтрации перелетов при помощи окна, расположенного в правой части экрана.
 - Билет или номер в отеле можно забронировать при нажатии кнопки BUY.
 - Кнопка Profile при нажатии позволяет получить информацию о пользователе: имя пользователя, роль(user,admin), баланс, список действующих перелетов и отелей, а также историю прошлых бронирований.


Профиль пользователя:

 - Пополнение баланса осуществляется при нажатии на знак +, в всплывшем модальном окне указывается сумма пополнение, послечего пополнение подтверждается нажатием кнопки Submit.
 - Список действующих бронирований перелетов или отелей получается при нажатии на знак стрелки. Списки можно скрыть повторным нажатием.
 - Список прошлых бронирований перелетов или отелей получается при нажатии на соответствующие надписи: "История полетов", "История отелей".
 - Пользователь может так же посмотреть фотографии отелей, нажав на их название.
 - Пользователь может загружать фотографии отелей, если он уже отдохнул в каком-то из отелей, для этого ему необходимо зайти в историю бронирования отелей и нажать на название, далее пользователь выбирает необходимый файл со своего компьютера и нажимает кнопку Submit для отправки.
 - У пользователя с ролью admin существует возможность удаления фотографий других пользователей.


Панель администратора (доступ только у пользователя с ролью: admin):

 - Кнопка All Countries позволяет получить список всех имеющихся в системе стран.
 - Кнопка All Aviacomopanies позволяет получить спсиок всех имеющихся в системе авиакомпаний.
 - Кнопка All Flights позволяет получить спсиок всех имеющихся в системе перелетов.
 - Кнопка All Hotels позволяет получить список всех имеющихся в системе отелей.
 - Кнопка All Airports позволяет получить спсок всех имеющихся в системе аэропортов.
 - Кнопка Create Airport позволяет добавить в систему новый аэропорт.
 - Кнопка Create Aviacompany позволяет добавить в систему новую авикомпанию.
 - Кнопка Create Country позволяет добавить в систему новую страну.
 - Кнопка Create Hotel позволяет добавить в систему новый отель.
 - Кнопка Create Flight позвоялет добавить в систему новый перелет.

Для каждой сущности определены операции изменения и удаления:
 - Удаление происходит при нажатии на знак креста.
 - Изменение происходит при нажатии на знак карандаша, после чего открывается модальное окно, в которое вносятся необходимые поправки.
 

Пользователь может выйти из системы при нажатии кнопки Logout.

- **API:** node.js (express)
# Технологии разработки
## Языки программирования
SQL, javascript
## ORM
Sequelize
## СУБД
postgreSQL

# Скрипты для развертывания системы
## Серверное приложение в директории backendBD
- `npm install` - установка всех необходимых dependencies
- `npm start` - запуск в стандартном режиме
- `npm run dev` - запуск в режиме разработки (автоматический перезапуск при сохраненных изменениях в коде)
## Клиентское приложение в директории frontendBD
- `npm install` - установка всех необходимых dependencies
- `npm start` - запуск в стандартном режиме
